<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Life Stories Now — Share your story. Help someone today.</title>
    <meta name="description" content="LifeStoriesNow lets people anonymously share moments, lessons, and advice. Read, reflect, and add your story to help someone today." />
    <link rel="canonical" href="https://lifestoriesnow.com/" />

    <!-- Search & theming -->
    <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />
    <meta name="theme-color" content="#0f172a" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />

    <!-- Icons / PWA -->
    <link rel="icon" type="image/png" href="/book.png" />
    <link rel="apple-touch-icon" href="/icon-180.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Social cards -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="LifeStoriesNow" />
    <meta property="og:title" content="Life Stories Now — Share your story. Help someone today." />
    <meta property="og:description" content="Share your story anonymously and inspire someone who needs it." />
    <meta property="og:url" content="https://lifestoriesnow.com/" />
    <meta property="og:image" content="https://lifestoriesnow.com/book-og.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="LifeStoriesNow blue open book logo" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Life Stories Now — Share your story. Help someone today." />
    <meta name="twitter:description" content="Share your story anonymously and inspire someone who needs it." />
    <meta name="twitter:image" content="https://lifestoriesnow.com/book-og.jpg" />

    <!-- Small perf wins -->
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://www.google-analytics.com" crossorigin />

    <!-- Structured data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Life Stories Now",
      "url": "https://lifestoriesnow.com/"
    }
    </script>

    <!-- Google tag (GA4) — keep in <head> -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N67K46X2JM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      // If you add client-side routing later, switch to: send_page_view: false
      gtag('config', 'G-N67K46X2JM');
    </script>
  </head>

  <body>
    <noscript>This site works best with JavaScript enabled.</noscript>
    <div id="root"></div>

    <!-- Your app script -->
    <script type="module" src="/src/main.jsx"></script>

    <!-- Lightweight engagement tracking (scroll, clicks, simple time-on-page) -->
    <script>
      (function () {
        // guard: don't error if analytics is blocked
        const hasGtag = () => typeof window.gtag === 'function';

        // ---- Scroll depth (fire once per threshold) ----
        const thresholds = [25, 50, 90];
        const fired = new Set();

        function onScroll() {
          const doc = document.documentElement;
          const max = Math.max(
            doc.scrollHeight,
            document.body.scrollHeight || 0
          );
          const viewportBottom = window.scrollY + window.innerHeight;
          const pct = Math.round((viewportBottom / max) * 100);

          thresholds.forEach(t => {
            if (pct >= t && !fired.has(t)) {
              fired.add(t);
              if (hasGtag()) gtag('event', 'scroll_depth', { value: t });
            }
          });
        }
        // Throttle scroll handler a bit
        let scrollTick = false;
        window.addEventListener('scroll', function () {
          if (!scrollTick) {
            scrollTick = true;
            requestAnimationFrame(function () {
              onScroll();
              scrollTick = false;
            });
          }
        }, { passive: true });

        // Initial check (short pages)
        window.addEventListener('load', onScroll);

        // ---- Clicks on links & buttons ----
        document.addEventListener('click', function (e) {
          const target = e.target.closest('a, button');
          if (!target) return;

          const label =
            (target.innerText && target.innerText.trim().slice(0, 80)) ||
            target.getAttribute('aria-label') ||
            target.href ||
            'unlabeled';

          if (hasGtag()) {
            gtag('event', 'interaction', {
              event_category: target.tagName.toLowerCase(),
              event_label: label
            });
          }
        });

        // ---- Simple time-on-page pings (10s & 30s) ----
        function pingAfter(ms, name) {
          const id = setTimeout(() => {
            if (hasGtag()) gtag('event', name);
          }, ms);

          // Pause timer when tab is hidden, resume when visible
          let start, remaining = ms;
          function onHide() {
            if (document.hidden) {
              clearTimeout(timerId.current);
              remaining -= Date.now() - start;
            } else {
              start = Date.now();
              timerId.current = setTimeout(() => {
                if (hasGtag()) gtag('event', name);
                cleanup();
              }, Math.max(0, remaining));
            }
          }
          const timerId = { current: id };
          function cleanup() {
            document.removeEventListener('visibilitychange', onHide);
          }
          start = Date.now();
          document.addEventListener('visibilitychange', onHide);
        }
        pingAfter(10000, 'time_10s');
        pingAfter(30000, 'time_30s');
      })();
    </script>
  </body>
</html>
